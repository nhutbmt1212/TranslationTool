import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import languagesMetadata from './data/languages.json';
import { LanguageMetadata } from './types/languages';

const metadataList = languagesMetadata as LanguageMetadata[];

const metadataMap = metadataList.reduce<Record<string, LanguageMetadata>>((acc, lang) => {
  acc[lang.code] = lang;
  return acc;
}, {});

const resources = {
  en: {
    translation: {
      app: {
        title: 'DALIT',
        subtitle: 'AI-powered translation platform',
      },
      header: {
        uiLanguageLabel: 'Interface language',
        settings: 'Settings',
        darkMode: 'Dark',
        lightMode: 'Light',
        switchDark: 'Switch to dark mode',
        switchLight: 'Switch to light mode',
      },
      source: {
        autoDetect: 'Auto detect',
        placeholder: 'Enter text to translate...',
        captureTitle: 'Capture or pick an image to translate',
      },
      target: {
        placeholder: 'Translations will appear here...',
      },
      buttons: {
        openLanguagePicker: 'Choose language',
        swapLanguages: 'Swap languages',
        copy: 'Copy text',
        translate: 'Translate',
      },
      status: {
        ocrInProgress: 'Performing OCR…',
        translating: 'Translating…',
        processing: 'Processing...',
      },
      ocr: {
        badge: '✨ Gemini API (Free)',
      },
      imageTranslator: {
        title: 'Image Translator',
        subtitle: 'Translate text in images',
        uploadText: 'Click to upload image',
        uploadHint: 'PNG, JPG, JPEG up to 10MB',
        original: 'Original',
        translated: 'Translated',
        reset: 'Reset',
        translate: 'Translate',
        download: 'Download',
        processing: 'Processing...',
        feature1: 'Detect text in image',
        feature2: 'Translate to target language',
        feature3: 'Replace text in original image',
        or: 'OR',
      },
      languagePicker: {
        titleSource: 'Select source language',
        titleTarget: 'Select target language',
        tabSource: 'Source',
        tabTarget: 'Target',
        eyebrow: 'Language roster',
      },
      settings: {
        eyebrow: 'CONFIGURATION',
        title: 'Settings',
        save: 'Save',
        cancel: 'Cancel',
        saving: 'Saving...',
        close: 'Close',
        tabs: {
          apiKey: 'API Key',
          update: 'Update',
          shortcuts: 'Shortcuts',
          textSelectionIgnore: 'Text Selection',
          features: 'Features',
        },
        shortcuts: {
          globalTitle: 'Global Shortcuts',
          globalDesc: 'These shortcuts work anywhere on your system',
          appTitle: 'App Shortcuts',
          appDesc: 'These shortcuts work when the app is focused',
          screenCapture: 'Quick screen capture & translate',
          translateSelection: 'Translate selected text',
          translate: 'Translate text',
          pasteTranslate: 'Paste and translate',
          tip: 'Tip: Select any text and a translate button will appear automatically!',
        },
        textSelectionIgnore: {
          title: 'Text Selection Ignore List',
          description: 'Disable text selection popup in specific applications (like .gitignore)',
          enableFeature: 'Enable text selection ignore',
          addApp: 'Add application',
          placeholder: 'e.g., kiro.exe, code.exe, notepad.exe',
          add: 'Add',
          hint: 'Enter the executable name (e.g., kiro.exe) to disable text selection popup',
          ignoredApps: 'Ignored applications',
          noApps: 'No applications in ignore list',
          remove: 'Remove',
          saved: 'Text selection ignore config saved successfully!',
          saveFailed: 'Failed to save config',
        },
        features: {
          title: 'Features',
          description: 'Enable or disable application features',
          quickCapture: 'Quick screen capture & translate (Ctrl+Shift+0)',
          quickCaptureHint: 'Enable quick screen capture and translate with Ctrl+Shift+0 shortcut',
          textSelection: 'Text selection popup',
          textSelectionHint: 'Show translate button when selecting text',
          textSelectionIgnore: 'Enable text selection ignore list',
          textSelectionIgnoreHint: 'Use ignore list to disable text selection popup in specific applications',
          saved: 'Features settings saved successfully!',
          saveFailed: 'Failed to save features settings',
          loading: 'Loading...',
        },
        apiKey: {
          title: 'Gemini API Key',
          description: 'Your API key is encrypted and stored securely on your device. It will remain saved until you clear it manually.',
          placeholder: 'Enter your Gemini API Key',
          current: 'Current API Key:',
          enter: 'Enter API Key',
          update: 'Update API Key',
          clear: 'Clear API Key',
          hint: 'Get your API key from Google AI Studio',
          getKey: 'Get API Key',
          saved: 'API key saved successfully!',
          confirmClear: 'Are you sure you want to clear the API key?',
          cleared: 'API key cleared successfully!',
        },
        errors: {
          emptyKey: 'API key cannot be empty',
        },
        security: {
          title: 'Security',
          encrypted: 'API key is encrypted using AES-GCM',
          session: 'Stored permanently on your device',
          device: 'Encryption key is device-specific',
          noServer: 'Never sent to any server except Google AI',
        },
        update: {
          title: 'App Update',
          description: 'Check and install the latest version of the application.',
          currentVersion: 'Current version',
          checkUpdate: 'Check for updates',
          checking: 'Checking...',
          downloading: 'Downloading update...',
          downloadProgress: 'Download progress',
          newVersion: 'New version available!',
          versionAvailable: 'Version {{version}} is available',
          readyToInstall: 'Update ready!',
          readyDescription: 'Version {{version}} has been downloaded',
          download: 'Download',
          installNow: 'Install now',
          noUpdate: 'You are using the latest version',
          error: 'Update check failed',
          notAvailable: 'Update not available in this environment',
          timeout: 'Timeout: Cannot connect to update server',
          timeoutMessage: 'Update check took too long, please try again',
          downloadFailed: 'Download failed. Retrying... ({{retry}}/3)',
          downloadFailedFinal: 'Download failed after 3 attempts. Please check your network connection.',
          downloadFailedRetry: 'Cannot download update. Please try again later.',
          paused: 'Paused',
          pauseToast: 'Download paused',
          resumeToast: 'Resume download',
        },
      },
      general: {
        characters_one: '{{count}} character',
        characters_other: '{{count}} characters',
      },
      errors: {
        inputRequired: 'Please enter text to translate',
        missingGeminiKey: 'Please configure your API key in Settings',
        invalidImageFile: 'Please pick a valid image file',
        noTextFoundInImage: 'No text found in the selected image',
        ocrFailure: 'Unable to recognise text from the image',
        noResponse: 'Empty response from Gemini',
        invalidTranslationResponse: 'Gemini response has invalid JSON format',
        noTranslationOutput: 'Gemini did not return the translated text',
        translationRequestFailed: 'Failed to call Gemini API',
        unknown: 'Something went wrong, please try again',
      },
      screenCapture: {
        button: 'Screen Capture',
        tooltip: 'Capture screen region',
        selecting: 'Selecting...',
        capturing: 'Capturing...',
        success: 'Screen region captured successfully',
        errors: {
          startFailed: 'Failed to start screen capture',
          captureFailed: 'Failed to capture screen region',
          notAvailable: 'Screen capture not available',
        },
      },
      quickCapture: {
        tooltip: 'Quick screen capture and translate',
        selecting: 'Select region to translate...',
        processing: 'Processing image...',
        success: 'Text extracted and ready to translate!',
        noText: 'No text found in the selected region',
        error: 'Failed to capture and process image',
      },
    },
  },
  vi: {
    translation: {
      app: {
        title: 'DALIT',
        subtitle: 'Nền tảng dịch thuật AI',
      },
      header: {
        uiLanguageLabel: 'Ngôn ngữ giao diện',
        settings: 'Cài đặt',
        darkMode: 'Tối',
        lightMode: 'Sáng',
        switchDark: 'Chuyển sang chế độ tối',
        switchLight: 'Chuyển sang chế độ sáng',
      },
      source: {
        autoDetect: 'Tự động phát hiện',
        placeholder: 'Nhập văn bản cần dịch...',
        captureTitle: 'Chụp/Chọn ảnh để dịch',
      },
      target: {
        placeholder: 'Bản dịch sẽ hiển thị ở đây...',
      },
      buttons: {
        openLanguagePicker: 'Chọn ngôn ngữ',
        swapLanguages: 'Đổi ngôn ngữ',
        copy: 'Sao chép',
        translate: 'Dịch',
      },
      status: {
        ocrInProgress: 'Đang nhận diện văn bản...',
        translating: 'Đang dịch...',
        processing: 'Đang xử lý...',
      },
      ocr: {
        badge: '✨ Gemini API (Miễn phí)',
      },
      imageTranslator: {
        title: 'Dịch ảnh',
        subtitle: 'Dịch văn bản trong ảnh',
        uploadText: 'Click để tải ảnh lên',
        uploadHint: 'PNG, JPG, JPEG tối đa 10MB',
        original: 'Gốc',
        translated: 'Đã dịch',
        reset: 'Đặt lại',
        translate: 'Dịch',
        download: 'Tải xuống',
        processing: 'Đang xử lý...',
        feature1: 'Phát hiện văn bản trong ảnh',
        feature2: 'Dịch sang ngôn ngữ đích',
        feature3: 'Thay thế văn bản trong ảnh gốc',
        or: 'HOẶC',
      },
      languagePicker: {
        titleSource: 'Chọn ngôn ngữ nguồn',
        titleTarget: 'Chọn ngôn ngữ đích',
        tabSource: 'Nguồn',
        tabTarget: 'Đích',
        eyebrow: 'Bộ sưu tập ngôn ngữ',
      },
      settings: {
        eyebrow: 'CẤU HÌNH',
        title: 'Cài đặt',
        save: 'Lưu',
        cancel: 'Hủy',
        saving: 'Đang lưu...',
        close: 'Đóng',
        tabs: {
          apiKey: 'Khóa API',
          update: 'Cập nhật',
          shortcuts: 'Phím tắt',
          textSelectionIgnore: 'Chọn văn bản',
          features: 'Tính năng',
        },
        shortcuts: {
          globalTitle: 'Phím tắt toàn cục',
          globalDesc: 'Các phím tắt này hoạt động ở mọi nơi trên hệ thống',
          appTitle: 'Phím tắt ứng dụng',
          appDesc: 'Các phím tắt này hoạt động khi ứng dụng đang được focus',
          screenCapture: 'Chụp màn hình nhanh & dịch',
          translateSelection: 'Dịch văn bản đã chọn',
          translate: 'Dịch văn bản',
          pasteTranslate: 'Dán và dịch',
          tip: 'Mẹo: Chọn bất kỳ văn bản nào và nút dịch sẽ tự động xuất hiện!',
        },
        textSelectionIgnore: {
          title: 'Danh sách bỏ qua chọn văn bản',
          description: 'Vô hiệu hóa popup chọn văn bản trong các ứng dụng cụ thể (giống .gitignore)',
          enableFeature: 'Bật tính năng bỏ qua chọn văn bản',
          addApp: 'Thêm ứng dụng',
          placeholder: 'vd: kiro.exe, code.exe, notepad.exe',
          add: 'Thêm',
          hint: 'Nhập tên file thực thi (vd: kiro.exe) để vô hiệu hóa popup chọn văn bản',
          ignoredApps: 'Ứng dụng bị bỏ qua',
          noApps: 'Chưa có ứng dụng nào trong danh sách',
          remove: 'Xóa',
          saved: 'Đã lưu cấu hình bỏ qua chọn văn bản thành công!',
          saveFailed: 'Lưu cấu hình thất bại',
        },
        features: {
          title: 'Tính năng',
          description: 'Bật hoặc tắt các tính năng của ứng dụng',
          quickCapture: 'Chụp nhanh và dịch (Ctrl+Shift+0)',
          quickCaptureHint: 'Bật tính năng chụp màn hình nhanh và dịch với phím tắt Ctrl+Shift+0',
          textSelection: 'Popup chọn văn bản',
          textSelectionHint: 'Hiển thị nút dịch khi chọn văn bản',
          textSelectionIgnore: 'Bật danh sách bỏ qua chọn văn bản',
          textSelectionIgnoreHint: 'Sử dụng danh sách bỏ qua để tắt popup chọn văn bản trong các ứng dụng cụ thể',
          saved: 'Đã lưu cài đặt tính năng thành công!',
          saveFailed: 'Lưu cài đặt tính năng thất bại',
          loading: 'Đang tải...',
        },
        apiKey: {
          title: 'Khóa API Gemini',
          description: 'Khóa API của bạn được mã hóa và lưu trữ an toàn trên thiết bị. Nó sẽ được giữ lại cho đến khi bạn xóa thủ công.',
          placeholder: 'Nhập khóa API Gemini của bạn',
          current: 'Khóa API hiện tại:',
          enter: 'Nhập khóa API',
          update: 'Cập nhật khóa API',
          clear: 'Xóa khóa API',
          hint: 'Lấy khóa API từ Google AI Studio',
          getKey: 'Lấy khóa API',
          saved: 'Đã lưu khóa API thành công!',
          confirmClear: 'Bạn có chắc chắn muốn xóa khóa API?',
          cleared: 'Đã xóa khóa API thành công!',
        },
        errors: {
          emptyKey: 'Khóa API không được để trống',
        },
        security: {
          title: 'Bảo mật',
          encrypted: 'Khóa API được mã hóa bằng AES-GCM',
          session: 'Lưu trữ vĩnh viễn trên thiết bị của bạn',
          device: 'Khóa mã hóa dành riêng cho thiết bị',
          noServer: 'Không bao giờ gửi đến máy chủ nào trừ Google AI',
        },
        update: {
          title: 'Cập nhật ứng dụng',
          description: 'Kiểm tra và cài đặt phiên bản mới nhất của ứng dụng.',
          currentVersion: 'Phiên bản hiện tại',
          checkUpdate: 'Kiểm tra cập nhật',
          checking: 'Đang kiểm tra...',
          downloading: 'Đang tải cập nhật...',
          downloadProgress: 'Tiến độ tải',
          newVersion: 'Có phiên bản mới!',
          versionAvailable: 'Phiên bản {{version}} đã có sẵn',
          readyToInstall: 'Sẵn sàng cài đặt!',
          readyDescription: 'Phiên bản {{version}} đã được tải xuống',
          download: 'Tải về',
          installNow: 'Cài đặt ngay',
          noUpdate: 'Bạn đang sử dụng phiên bản mới nhất',
          error: 'Lỗi kiểm tra cập nhật',
          notAvailable: 'Cập nhật không khả dụng trong môi trường này',
          timeout: 'Timeout: Không thể kết nối đến server update',
          timeoutMessage: 'Kiểm tra update quá lâu, vui lòng thử lại',
          downloadFailed: 'Download thất bại. Đang thử lại... ({{retry}}/3)',
          downloadFailedFinal: 'Download thất bại sau 3 lần thử. Vui lòng kiểm tra kết nối mạng.',
          downloadFailedRetry: 'Không thể tải update. Vui lòng thử lại sau.',
          paused: 'Đã tạm dừng',
          pauseToast: 'Download đã tạm dừng',
          resumeToast: 'Tiếp tục download',
        },
      },
      general: {
        characters_one: '{{count}} ký tự',
        characters_other: '{{count}} ký tự',
      },
      errors: {
        inputRequired: 'Vui lòng nhập văn bản cần dịch',
        missingGeminiKey: 'Vui lòng cấu hình khóa API trong Cài đặt',
        invalidImageFile: 'Vui lòng chọn file ảnh hợp lệ',
        noTextFoundInImage: 'Không tìm thấy văn bản trong hình ảnh',
        ocrFailure: 'Không thể nhận diện văn bản, hãy thử lại',
        noResponse: 'Không nhận được phản hồi từ Gemini',
        invalidTranslationResponse: 'Phản hồi Gemini không đúng định dạng JSON',
        noTranslationOutput: 'Gemini không trả về bản dịch',
        translationRequestFailed: 'Lỗi khi gọi Gemini API',
        unknown: 'Đã xảy ra lỗi, vui lòng thử lại',
      },
      screenCapture: {
        button: 'Chụp màn hình',
        tooltip: 'Chụp vùng màn hình',
        selecting: 'Đang chọn...',
        capturing: 'Đang chụp...',
        success: 'Đã chụp vùng màn hình thành công',
        errors: {
          startFailed: 'Không thể bắt đầu chụp màn hình',
          captureFailed: 'Không thể chụp vùng màn hình',
          notAvailable: 'Chức năng chụp màn hình không khả dụng',
        },
      },
      quickCapture: {
        tooltip: 'Chụp nhanh và dịch',
        selecting: 'Chọn vùng để dịch...',
        processing: 'Đang xử lý ảnh...',
        success: 'Đã trích xuất văn bản và sẵn sàng dịch!',
        noText: 'Không tìm thấy văn bản trong vùng đã chọn',
        error: 'Không thể chụp và xử lý ảnh',
      },
    },
  },
};

const uiLanguageCodes = ['en', 'vi'];

export const uiLanguageOptions = uiLanguageCodes.map((code) => {
  const metadata = metadataMap[code];
  const label = metadata
    ? code === 'vi'
      ? metadata.nameNative || metadata.nameEn
      : metadata.nameEn
    : code.toUpperCase();

  return { code, label };
});

if (!i18n.isInitialized) {
  i18n.use(initReactI18next).init({
    resources,
    fallbackLng: 'en',
    supportedLngs: uiLanguageCodes,
    defaultNS: 'translation',
    interpolation: {
      escapeValue: false,
    },
  });
}

export default i18n;

